{% extends "base.html" %}

{%block meta%}
<meta property="og:image" content="/og/{{file_path}}">
{% endblock meta%}

{% block title %}{{ title }}{% endblock title %}

{% block content %}
    <h1>{{title}}</h1>
{% if headings %}
<div class="table-of-contents">
    <h3>Contents</h3>
    <ul>
        {% for heading in headings %}
            <li class="toc-level-{{ heading.0 }}">
                <a href="#{{ heading.2 }}">{{ heading.1 }}</a>
            </li>
        {% endfor %}
    </ul>
</div>
{% endif %}
    <article>
        {% if date %}<div class="date">{{ date }}</div>{% endif %}
        {% if author %}<div class="author">By {{ author }}</div>{% endif %}
        {% if category %}<div class="category">Category: {{ category }}</div>{% endif %}

        <div class="markdown-content">
        {{ content | safe }}
        </div>
        
        {% if draft %}
            <div class="draft-notice">⚠️ This is a draft post</div>
        {% endif %}
    </article>

<script>
function copyCode(button) {
    const codeBlock = button.closest('.code-block').querySelector('code');
    const codeLines = codeBlock.querySelectorAll('.code-line');
    const codeText = Array.from(codeLines)
        .map(line => line.innerText)
        .join('\n');
    
    navigator.clipboard.writeText(codeText).then(() => {
        button.textContent = 'Copied!';
        setTimeout(() => {
            button.textContent = 'Copy';
        }, 2000);
    }).catch((err) => {
        console.error('Failed to copy text: ', err);
        button.textContent = 'Failed';
    });
}
</script>
{% endblock content %}